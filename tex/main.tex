
%% Author_tex.tex
%% V1.0
%% 2012/13/12
%% developed by Techset
%%
%% This file describes the coding for rsproca.cls
\documentclass[PTRSB]{rsos}
\makeatletter\if@twocolumn\PassOptionsToPackage{switch}{lineno}\else\fi\makeatother

%Publisher: Royal Society
%Template Provided By: Typeset

\usepackage{amsmath,tabulary,graphicx}
\usepackage[utf8]{inputenc}
\long\def\ack#1{{\vskip5.5pt\noindent \fontsize{8}{11}\selectfont#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Following additional macros are required to function some 
% functions which are not available in the class used.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{url,multirow,morefloats,floatflt,cancel,tfrupee}
\makeatletter


\AtBeginDocument{\@ifpackageloaded{textcomp}{}{\usepackage{textcomp}}}
\makeatother
\usepackage{colortbl}
\usepackage{xcolor}
\usepackage{pifont}
\usepackage[nointegrals]{wasysym}
\urlstyle{rm}
\makeatletter

%%%For Table column width calculation.
\def\mcWidth#1{\csname TY@F#1\endcsname+\tabcolsep}

%%Hacking center and right align for table
\def\cAlignHack{\rightskip\@flushglue\leftskip\@flushglue\parindent\z@\parfillskip\z@skip}
\def\rAlignHack{\rightskip\z@skip\leftskip\@flushglue \parindent\z@\parfillskip\z@skip}


%\if@twocolumn\usepackage{dblfloatfix}\fi
\usepackage{ifxetex}
\ifxetex\else\if@twocolumn\usepackage{dblfloatfix}\fi\fi

\AtBeginDocument{
\expandafter\ifx\csname eqalign\endcsname\relax
\def\eqalign#1{\null\vcenter{\def\\{\cr}\openup\jot\m@th
  \ialign{\strut$\displaystyle{##}$\hfil&$\displaystyle{{}##}$\hfil
      \crcr#1\crcr}}\,}
\fi
}

%For fixing hardfail when unicode letters appear inside table with endfloat
\AtBeginDocument{%
  \@ifpackageloaded{endfloat}%
   {\renewcommand\efloat@iwrite[1]{\immediate\expandafter\protected@write\csname efloat@post#1\endcsname{}}}{}%
}%

\def\BreakURLText#1{\@tfor\brk@tempa:=#1\do{\brk@tempa\hskip0pt}}
\let\lt=<
\let\gt=>
\def\processVert{\ifmmode|\else\textbar\fi}
\let\processvert\processVert

\@ifundefined{subparagraph}{
\def\subparagraph{\@startsection{paragraph}{5}{2\parindent}{0ex plus 0.1ex minus 0.1ex}%
{0ex}{\normalfont\small\itshape}}%
}{}

These are now gobbled, so won't appear in the PDF.
\newcommand\role[1]{\unskip}
\newcommand\aucollab[1]{\unskip}
  
\@ifundefined{tsGraphicsScaleX}{\gdef\tsGraphicsScaleX{1}}{}
\@ifundefined{tsGraphicsScaleY}{\gdef\tsGraphicsScaleY{.9}}{}
To automatically resize figures to fit inside the text area
\def\checkGraphicsWidth{\ifdim\Gin@nat@width>\linewidth
	\tsGraphicsScaleX\linewidth\else\Gin@nat@width\fi}

\def\checkGraphicsHeight{\ifdim\Gin@nat@height>.9\textheight
	\tsGraphicsScaleY\textheight\else\Gin@nat@height\fi}

%\def\fixFloatSize#1{}%\@ifundefined{processdelayedfloats}{\setbox0=\hbox{\includegraphics{#1}}\ifnum\wd0<\columnwidth\relax\renewenvironment{figure*}{\begin{figure}}{\end{figure}}\fi}{}}
%\let\ts@includegraphics\includegraphics

\def\inlinegraphic[#1]#2{{\edef\@tempa{#1}\edef\baseline@shift{\ifx\@tempa\@empty0\else#1\fi}\edef\tempZ{\the\numexpr(\numexpr(\baseline@shift*\f@size/100))}\protect\raisebox{\tempZ pt}{\ts@includegraphics{#2}}}}

%\renewcommand{\includegraphics}[1]{\ts@includegraphics[width=\checkGraphicsWidth]{#1}}
\AtBeginDocument{\def\includegraphics{\@ifnextchar[{\ts@includegraphics}{\ts@includegraphics[width=\checkGraphicsWidth,height=\checkGraphicsHeight,keepaspectratio]}}}

\def\URL#1#2{\@ifundefined{href}{#2}{\href{#1}{#2}}}

%%For url break
\def\UrlOrds{\do\*\do\-\do\~\do\'\do\"\do\-}%
\g@addto@macro{\UrlBreaks}{\UrlOrds}

\@ifundefined{quoteAttrib}
	{\long\def\quoteAttrib#1{\par\raggedleft\itshape#1\unskip}}
	{}

\@ifundefined{titlequoteAttrib}
	{\long\def\titlequoteAttrib#1{\list{}{\topsep-3pt\leftmargin.5in\rightmargin0pt}%
  \item\relax---\upshape#1\endlist}}{}

\renewenvironment{quote}
	{\list{}{\leftmargin.5in\rightmargin\leftmargin}%
  \item\relax}
  {\endlist}

\newenvironment{title-quote}
	{\list{}{\fontsize{10pt}{12pt}\selectfont\leftmargin.5in\itshape\rightmargin\leftmargin}%
  \item\relax}
  {\endlist}


\makeatother
\def\floatpagefraction{0.8} 
\def\dblfloatpagefraction{0.8}
\def\style#1#2{#2}
\def\xxxguillemotleft{\fontencoding{T1}\selectfont\guillemotleft}
\def\xxxguillemotright{\fontencoding{T1}\selectfont\guillemotright}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\Journal{Phil. Trans. R. Soc. B }

\usepackage[nolists,nomarkers]{endfloat}

%%%% Article title to be placed here
\title{Single-World Counterfactual Inference}

\author{%%%% Author details
Joshua Kaminsky$^{1}$, Lindsay T. Keegan$^{1}$,\\C. Jessica E. Metcalf$^{12}$ and Justin Lessler$^{1}$}

%%%%%%%%% Insert author address here
\address{$^{1}$Department of Epidemiology, Johns Hopkins Bloomberg School of Public Health, Baltimore, MD, USA\\
$^{2}$Department of Ecology and Evolutionary Biology, Princeton University, Princeton, NJ, USA}

%%%% Subject entries to be placed here %%%%
\subject{Epidemiology, Infectious Disease Modeling}

%%%% Keyword entries to be placed here %%%%
\keywords{Counterfactuals, Infectious disease modeling, Infectious disease Dynamics, Network Modeling}

%%%% Insert corresponding author and its email address}
\corres{Justin Lessler\\
\email{justin@jhu.edu}}

\begin{document}
%%%% Abstract text to be placed here %%%%%%%%%%%%
% Recount words
\begin{abstract} % 154 words MAX 183 words
  Determining the effects of an intervention on a disease outbreak is an important problem in epidemiology.
  However, multiple confounders and sources of noise make it difficult to address. %23 words
  Here we present a method that addresses an important source of noise, stochastic variation within the same population. %21 words
  This allows for improved ability to select the best interventions for an outbreak
  Our method, like many others, employs compartmental models and extends an individual-level effect of the intervention to the population-level effect. %20 words
  We eliminate stochastic variation between epidemics by tracking both what happens with intervention and what happens without intervention within a single simulated epidemic. %24 words
  To simultaneously keep track of both states, we store all transition states that are possible either with or without the intervention on a network. %21 words
  We can actualize this network to recover the events that occur both with and without the intervention. %
  We demonstrate our method on an influenza epidemic and compare the results of our method to an existing method.
  We compare across three interventions: hand-washing, vaccination, antivirals, and a control; and evaluate performance on the estimate of cases averted.
  We find that our method reduces the variance of all estimates, and in one case makes the results statistically significant. %25 words
  Although our method is more computationally intensive than traditional methods, it is still computationally tractable for many common use cases, making it a useful tool for selecting interventions. %17 words
\end{abstract}
%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%% End of first page %%%%%%%%%%%%%%%%%%%%%

\maketitle


\section{Introduction}
Determining how to control an infectious disease outbreak is a fundamental question in epidemiology.
This process often relies on a combination of assessments, expert opinion, and disease surveillance, however in many outbreak settings, these may be unavailable. % CITE THIS PAPER [An approach to and web-based tool for infectious disease outbreak intervention analysis Ashlynn R. Daughton, Nicholas Generous, Reid Priedhorsky & Alina Deshpande]
By using available data across multiple levels, dynamical models provide quantitative estimates of outbreak progression in a timely manner, providing insight into how to respond.
Often these modeling approaches provide the best evidence-based estimates of the impact of an intervention when other methods are not feasible.

Determining the effect of an intervention is fundamentally a counterfactual question: how would the outcome of a given epidemic in a population have been different in the presence of a control strategy versus the absence of that control strategy.
For example, one can ask, in the case of the $2014$ Ebola epidemic in Liberia, how many cases of Ebola would have been averted by the widespread deployment of an effective vaccine.
However, this is impossible to know. 
This inability to know the counterfactual outcome is known as the fundamental problem of causal inference.\cite{holland:1986}

Although when responding to an epidemic we are stuck with the fundamental problem of causal inference, in a modeling framework, this can be averted.
However despite the fact that it can be averted, it is rarely formally addressed. 
While most existing models run separate simulations for both arms of the control regime, it is possible to model two different control strategies in a identical epidemic.
In this paper, we refer to models which run separate simulations for the outbreak and the intervention as multiple-world inference and we present a method here that runs a single simulation for the outbreak and all interventions, which we call single-world inference.

The majority of quantitative efforts used to determine the effectiveness of an intervention employ multiple-world inference \cite{} %CITE LESSLER, RIVERS, LONGINI, AND THE PAPER I ADDED ABOVE
However, multiple-world inference methods suffer from high variance and low statistical power, as the method involves comparing different simulated epidemics which often results in the effect of the intervention being obfuscated by process model variance.
For example, Lessler et al. 2016 encountered a common problem of multiple-world inference while determining the best way to trigger a measles vaccination campaign in Africa. 
They noted the requisite use of aggregate statistics as a limitation resulting from the use of multiple-world inference \cite{lessler-et-al:2016}.
Similarly, Rivers et al. 2014 encountered another common drawback of multiple-world inference when determining the impact of multiple interventions against Ebola.
For one of their control strategies, the variance was too large to detect a significant effect of the intervention \cite{rivers-et-al:2014}.
These papers exemplify the most common problems associated with multiple-world inference methods, however we assume there are far more unpublished examples where statistical power was not sufficient to yield definitive results.

The method we describe here, single-world inference, is an adaptation of a contact-network epidemiological method called percolation \cite{miller-book}.
Importantly, single-world inference avoids the fundamental problem of causal inference by running both arms of the counterfactual (i.e., employing the intervention and doing nothing) within a single simulation.
Percolation models disease transmission as a network whose nodes are people, and whose edges are transmissions (i.e., the transition from susceptible to infected).
It starts with a network of all possible transmissions and then removes both transmissions that are impossible and transmissions that are possible but do not happen as determined by the stochastic model, this removal of edges is known as ``pruning''.
Any edges that remain after pruning transmit disease.

Single-world inference expands the traditional percolation method in two important ways.
First, it explicitly models time: in single world inference, nodes represent a person at a specific time step and thus it directly models all state changes (e.g., susceptible to infected or infected to removed) rather than only considering transmissions.
Second, it includes an intervention: in single-world inference, each node gets assigned multiple states (i.e., a state for each intervention), unlike the percolation model in which it is only necessary to assign one state to each node.
As a result, in single-world inference, fewer transitions are removed than percolation would.

Although the vast majority of previous work has applied multiple-world inference to determine the outcome of an intervention on an epidemic, Kenah and Miller 2011 applied a single-world inference method to determine the impact of vaccinating highly connected nodes in a contact network \cite{kenah-miller:2011}.
While Kenah and Miller 2011 also percolate a contact network before applying an intervention, they do not describe a method to apply single-world inference to a general class of models or interventions \cite{kenah-miller:2011}.
Here we outline single-world inference using an influenza outbreak as a guiding example and then present a generalized method that can be applied to a whole class of compartmental models and a diversity of intererventions.

\section{Methods}
Single-world inference can take a large class of epidemiological models to explore outbreak trajectories with and without intervention. 
For the purpose of this paper, we restrict our development to compartmental models.
Extensions to other classes of models are beyond the scope of this paper.
Compartmental models consist of classes (or compartments) of people and describe the transitions between the different compartments.
There are many variations on compartmental models, but we focus on models where the transitions are stochastic.
Further, compartmental models generally describe population-level events, however most population-level models can be adapted to be written as individual-level models.
In this paper, we use individual-level compartmental models because often the only information we have on an intervention is at the individual-level.

\subsection{Example: Influenza}
To demonstrate single-world inference, we construct an influenza example using a standard Susceptible, Infected, Removed compartmental model.
By modeling influenza transmission within a single season we do not account for loss of immunity and we assume that births and deaths are negligible.
We allow the probability of an infectious contact between any particular susceptible-infected pair to be $\beta = 0.78$ per day and the probability of an infected individual recovering at any time step to be $\gamma = 0.44$ per day \cite{forsberg-white-et-al:2009}.

%% FIGURE 1
\begin{figure}[hp]
% \includegraphics[width=\textwidth]{../figures/figure8} %Probably turn the coloration into a legend.
\caption{Diagram of the steps in the pruning process.  We start with the complete network \textbf{a)}.  We prune according to the SIR model ignoring the intervention to obtain a potential network \textbf{b)}.  We then can choose to apply an intervention to obtain an intervention potential network \textbf{b${}^*$)}.  In either case, we then actualize the network \textbf{c)} or \textbf{c${}^*$)}.}
\label{fig:outline}
\end{figure}

%% FIGURE 2
\begin{figure}[hp]
% \includegraphics[width=\textwidth]{../figures/figure6} %Probably turn the coloration into a legend.
\caption{Diagram demonstrating pruning a complete network to obtain a potential network.  In all panels, the nodes represent people at different times.  The nodes in the same horizontal line represent a single person, moving through time.  Each node is split into three sections, representing wether it is potentially susceptible (upper left, purple), potentially infected (upper right, orange), or potentially removed (bottom, green).  If we know a node cannot be a state, we color the corresponding section of that node grey instead of its normal color.  The green edges represent potential recovery, the orange edges represent potential transmission.  Because the edges and nodes represent potential states, we make them translucent.  We mark removed edges by making them even more translucent (as they are impossible), before removing them entirely in the next panel.  \textbf{a)}--\textbf{k)} show a step by step example of pruning a complete network to construct a potential network.  Between the first and second columns, we update possible states of the nodes.  Between the second and third columns, we prune edges incompatible with the possible states on the network.  Between the third and first columns (wrapped around), we use the SIR model to determine which potential edges would occur in the epidemic.  The edges we remove at this stage are more transparent, and then removed in the next panel.}
\label{fig:pruning}
\end{figure}

Single-world inference begins with a network, which it prunes repeatedly to obtain the actual events that occur (Figure \ref{fig:outline}).
The network consists of a node for each person at each time step, and directed edges between the nodes.
In this example, there are three states that each node might have: potentially susceptible, potentially infected, and potentially removed; and two types of edges: potential transmissions and potential recoveries.
We first prune this network using information from the initial conditions and SIR model to construct a potential network.
We then prune the potential network using information from the intervention to construct an intervention potential network.
The potential networks represent that will happen if they are consistent with reality.
We finally prune both potential networks, removing inconsistencies, and recovery what actually does happen (Figure \ref{fig:outline}).

We use these networks for figures and computation, but when we discuss them we will use more natural language.
Instead of saying that there is a conditional tranmission edge between person $i$ at time $t$ and person $j$ at time $t+1$, we will say that person $i$ could transmit to person $j$ at time $t$.
Instead of saying that there is a conditional recovery edge between person $i$ at time $t$ and person $i$ at time $t+1$, we will say that person $i$ could recover at time $t$.

Without any information about the epidemic or intervention we can say almost nothing: each person is potentially infectious, potentially susceptible, and potentially removed at every time.
Additionally, each person could recover at any time, and each person could infect any other person at any time.
We call the network that contains all of these possibilities the complete network (Figure \ref{fig:outline} a)).

From the the complete network, we begin pruning.
Starting at time $0$, we do three things at each time step: determine the potential states of each person, determine the potential transmissions and recoveries, and evaluate potential transmissions and recoveries using the SIR model.
These steps are phrased positively, but we should actually think of this process as using additional information about the epidemic to rule out parts of the complete network.
In the first step, we eliminate node states, in the second step we eliminate edges, and in the third we get new information about the epidemic (Figure \ref{fig:pruning}).

To determine the potential states of each person, we look at their potential states at the last time step, whether they could have recovered, and whether another person could have transmitted to them.
We then use our knowledge about the model and the intervention to eliminate possible states.
Our initial conditions tell us that we can eliminate all but one state at time $0$.
No one becomes susceptible, so a person cannot be susceptible if they were not susceptible at the previous time step.
Only infected people can become removed, so a person is not removed if they could not have been infected nor removed at the previous time step.
Only people who are transmitted to become infected, so a person is not infected if they were not previously infected and there are no potential transmissions to them.
More than that, we know that no intervention prevents recovery, so any potential recoveries at the previous time step will happen if their conditions are met.
This means a person potentially infected at the previous time will not remain infected if there is a potential recovery.
We say that a person is not infected if they potentially recovered and there are not potential transmissions to them at the previous time step.
We could potentially make other observations that would allow us to prune more nodes, but these are all we prune in this case.
We discuss these observations more thoroughly in the general method.

With information about the current state of each person, we can eliminate possible transmissions and recoveries (e.g. a person cannot recover if they could not have been infected).
We then remove those edges.
We know that someone who cannot be infected does not transmit disease.
We know that someone who cannot be susceptible cannot have disease transmitted to them.
We know that someone who is not infected cannot recover.

At this stage, we need more information from the SIR model to proceed.
Transmissions are part of the epidemic with probability $\beta$; recoveries are part of the epidemic with probability $\gamma$.
Of all of the potential transmissions and recoveries, we eliminate them with the appropriate probability.
We then repeat all three steps for each time step.
The result is a network we a the potential network (Figure \ref{fig:outline} b)).

Now that we have the pruned network, applying our intervention is fairly straightforward.
We repeat the pruning procedure with one difference: instead of consulting the SIR model for information, we consult the intervention model.
This process modifies the potential network into a second potential network containin information from both the intervention and the SIR model (Figure \ref{fig:outline} b${}^*$)).
We could even, if we wanted to, apply another intervention on top of the first one, resulting in a potential network representing two interventions at the same time.

After we have applied any interventions we want, we need to actualize the network so that it represents actual states and events instead of potential ones.
Actualizing the network is very similar to the pruning process: we update the states of the nodes, and remove inconsistent edges.
Starting at time $0$, we set the state of each person to their initial state.
We then assume every potential transmission or recovery at time $0$ actually happens, which tells us everyone's state at time $1$.
This will make some transmissions and recoveries at time $1$ inconsistent (e.g. a recovered person transmitting to someone), so we remove those states.
We repeat this process for each time and obtain an actualized network (Figure \ref{fig:outline} c) and c${}^*$)).

This new network is similar to a transmission tree, as it contains all of the events as they happen in time.
In fact if we remove every recovery edge and any disconnected nodes, then this new newtork is a transmission tree.
Therefore it can be used to determine the course of the epidemic.
It is important to note that the intervention is applied after the SIR model has pruned the network.
Indeed, as long as we have the potential network, it can be used multiple times for different interventions.

We evaluate the effects of four control measures on influenza cases averted: hand-washing, vaccination, antivirals, and a null intervention.
We selected these example interventions to highlight different ways in which interventions can interact with single-world inference.
We assume that for hand-washing, everyone washes their hands and that it reduces the transmissibility of influenza by $1\%$.
For vaccination intervention, we choose $25\%$ of people to be vaccinated at the beginning of the season and assume it fully protects $33\%$ of those vaccinated
For the antiviral intervention, we choose $25\%$ of people to take antivirals when they first become infected, assume that it reduces their average duration of infection by $0.7$ days \cite{oseltamivir:2014}, and model this reduction in duration of infection as an additional $36.1\%$ chance of recovering at each time step.
To highlight the differences between single-world and multiple-world inference, we include a null intervention in which we do not intervene.
While this is not an intervention, it effectively demonstrates the ability of our method to reduce the process model variance.
We run $1,000$ simulations of each type of inference, for each intervention, on a population of $4,000$ for $100$ days and calculate the estimated number of cases averted.

\subsection{General Framework}\label{subsection:general}

We extend the single-world inference example to a general class of compartmental models and generic interventions by outlining the differences between the general method and the influenza example.
We define these as a system of difference equations with $K$ compartments governed by 
\begin{align*}
\Delta x_{j} &= \sum_{i \neq j} \alpha_{i,j}x_i + \sum_{i \neq j, k} \alpha_{i,j,k} x_ix_k.
\end{align*}
Where $\alpha_{i,j}$ is the probability that a person transitions from state $i$ to state $j$, and $\alpha_{i,j,k}$ is the probability that a person transitions from state $i$ to state $j$ after contacting with an individual in state $k$.
Each transition is represented both as entering a compartment $\alpha > 0$, and leaving a compartment $\alpha < 0$.
Since we are only interested in people entering new states, we only track positive values of $\alpha$.
We can rephrase our influenza example in these new terms where
\begin{align*}
    x_1 &= S, \\
    x_2 &= I, \\
    x_3 &= R,
\end{align*}
$\alpha_{2,1,2} = \beta $, and $\alpha_{3,2} = \gamma$ all other $\alpha_{i,j,k}$ and $\alpha_{i,j}$ are equal to $0$.

We still use a network with a node representing each person at each time.
The nodes still have multiple potential states, but now they are $x_1 \dots x_K$ instead of $S$, $I$, and $R$.
For each positive $\alpha_{i,j,k} $ and $\alpha_{i,j}$, we have a different type of edge.
Since $\alpha_{i,j,k}$ edges represent contacts, we connect each person at each time to every other person at the next time.
We call this type of edges interaction edges.
Since $\alpha_{i,j}$ edges represent spontaneous transitions, we connect each person at each time to themselves at the next time.
We call this type of edges transition edges.
For either category of edge, we call $i$ the from state and $j$ the to state.
Unlike in the influenza example, there may be multiple edges connecting the same pair of nodes.

We prune the network using the same three steps at each time step: determine potential states, determine potential edges, and consult the model for more information.
While the steps are the same, some of the reasoning needs to be generalized.
We need to generalize the assumptions that allow us to update the potential states of the nodes.
Once we generalize those assumptions, we will use them to generate rules for eliminating potential states.
We also need to generalize the edge elimination process for steps two and three.

We make two assumptions about interventions in the general case.
To state these assumptions, we first need two definitions.
A compartment $i$ is terminal if no one leaves that compartment ($\alpha_{i,j,k},\alpha_{i,j} \leq 0$ for all $j,k$).
An edge is redundant if its to state is terminal, or if it does not alter the potential state of any node.
Our first assumption is that an intervention does not add edges that are not redundant.
Our second assumption is that an intervention does not remove transition edges that are not redundant.
These assumptions are more restrictive in the general case than the SIR case, but still include most common interventions.

Using these assumptions about the intervention, we can use the following pruning rules.
A person is not in a compartment if they were not potentially in that compartment at the previous time, and could not have entered that compartment.
A person is not in a compartment if they would have left a compartment at the previous time if they were in it, and could not have entered the compartment.

We group the changes to both edge pruning steps together.
We can eliminate an interaction edge associated with $\alpha_{i,j,k}$ if $i$ is not a potential state of the source person.
We can eliminate an interaction edge associated with $\alpha_{i,j,k}$ if $k$ is not a potential state of the target person.
We can eliminate an interaction edge associated with $\alpha_{i,j}$ if $i$ is not a potential state of the person.
When consulting the model, we keep an edge with probability of the associated $\alpha_{i,j}$ or $\alpha_{i,j,k}$.
Once we have completed the three steps at each time step, we have our potential network.
We can do our second pruning to account for our intervention in the same way as the influenza example.

Our last step is to actualize the network.
Unlike in the influenza case, it is now possible that two different edges affect the same person at the same time, changing their state to two different states.
As an example, in an age cohort model, a susceptible child might be infected, and become an adult the same time step.
Unfortunately, there are many ways to handle this type of conflict, and the right way depends on the model.
In the age case, the correct answer is that both events happen, the susceptible child becomes an infected adult.
In a different case, the answer may be to choose randomly between the two events, or that one of the events takes priority over the other (a dead adult is just dead for example).

\section{Results}

%% TABLE 1
\begin{table}
\caption{Space and time complexity results for a brute-force single-world inference, our single-world inference (first and second prunings), and multiple-world inference.}
\begin{tabular}{|l|l|l|}
  \hline
  Task & Space Use & Time / simulation\\\hline
  Unpruned Network & $58.4$ TB & \textemdash \\\hline
  Prune Network (process model) & $1.73$ GB & 54 seconds \\\hline
  Prune Network (Control Strategy) & $1.3-1.4$ KB & $16-20$ seconds \\\hline
  Multiple-World Inference& $2.6-2.8$ KB &  22-24 seconds\\\hline
\end{tabular}
\label{table:performance}
\end{table}

%% FIGURE 3
\begin{figure}[hp]
\centering
\includegraphics[width=.31\textwidth]{../figures/intervention-effects-raw-boxplots}
\includegraphics[width=.31\textwidth]{../figures/intervention-effects-combined-boxplots}
\caption{\textbf{Left)} Boxplots of simulations results under the each intervention scenario.  Notice that all of the boxplots overlap, which implies that from the population perspective, the effects of the interventions are all insignificant.  \textbf{Right)} The single-world estimate of cases averted for each intervention scenario.  Unlike the right hand figure, very few of the boxplots overlap with The null intervention.}
\label{fig:boxplots}
\end{figure}

%% FIGURE 4
\begin{figure}[hp]
\centering
\includegraphics[width=.7\textwidth]{../figures/intervention-effects-time-series-susceptible-switched.pdf}
\caption{Time series showing the number of cases averted at each time caused by the intervention calculated using single-world inference and multiple-world inference.  We observe that single-world inference performs how you would expect the interventios to perform; cases prevented are almost always positive, and many of the cases prevented stay prevented (though not all). On the other hand, multiple-world inference generally has a very different shape, apparently possibly causing a large number of cases in the middle of the epidemic, and a lot of uncertainty surrounding the peak of the epidemic.}
\label{fig:epicurve}
\end{figure}

We define and demonstrate single-world inference and apply it to determining the impact of three interventions on the number of cases averted.
We compare the outcomes of single-world inference to the current standard way to simulate the effects of an intervention, multiple-world inference.
We find that single-world inference generally has the same point estimates as multiple-world inference, but with narrower confidence intervals.
We also see that multiple-world inference has some nonsensical results that single-world inference avoids.

For single-world inference, we found that every non-null intervention had a significant ($p<0.05$) number of cases averted: Null $0$ (CI $0-0$), Antivirals $819.125$ (CI $206 - 2899.05$), Social Distancing $153.594 $ (CI $12 - 298$), Vaccination $ 284.955 $ (CI $130 - 438$).
For multiple-world inference, we found that all but one non-null intervention had a significant ($p<0.05$) number of cases averted: Null  -$5 $ (CI  -$195 - 183$), Antivirals $814.185$ (CI $176 - 2913 $), Social Distancing $148.654$ (CI -$69 - 355$), Vaccination $280.015$ (CI $72 - 499$).
In addition to estimates of cases averted, we observe that multiple-world has an unintuitive effect on the shape of the epidemic (Figure \ref{epicurve}).

We released a software package, \texttt{counterfactual}, on \texttt{CRAN}, %NOTE: This is not true yet
which implements single-world inference as described in section \ref{sec:methods}.
It follows the assumptions and procedures outlined above, but does not enforce those assumptions, or deal with conflicting state changes.
The amount of space and time pruning takes in the software package is $\mathcal O(E)$, where $E[O(E)]$ which is on average $O(t(n^2\sum \alpha_{i,j,k} + n \sum\alpha_{i,j}))$ per simulation, or $O(t(n^2\beta + n\gamma))$ in the case of the SIR model.
The amount of time the interventions take is also $\mathcal O(E)$, but the constant is lower (Table \ref{table:performance}).
This shows us that the number of infectious compartments, the population, number of times, and number of simulations all impact the amount of time taken, but population has the biggest impact.

\section{Discussion}
In this paper, we present a method that can reduce uncertainty and variability in the underlying process model to reflect variability only in the intervention itself.
We demonstrate the ability of our method to factor away inter-epidemic variation via simulation and show that through precise simulation, our method avoids the issue of counterintuitive results. 
Additionally, our method is tractable when applied to a broad class of models and interventions, simultaneously: most of which are supported by our software package.

Inherently, our method sets out to address a different question than most simulation-based methods. 
Traditional methods simulate two completely independent epidemics in the same population, from the same parameters, with one epidemic intervened upon while the other is not. 
These address important policy questions: if you were to see another epidemic in the same population, what would the impact of an intervention look like on that epidemic. 
While the questions that traditional simulation-based method can address are vitally important, our method sets out to address a more precise question. 
Given two precisely identical epidemics what is the effect of the intervention. 
This method precisely isolates the expected intervention impact which allows for a better comparison of interventions or a better understanding of the true differences between control programs.

Even at asking this different question, single-world inference has some inherent limitations.
Discrete time compartmental models are not cutting edge modeling techniques.
Our method is discrete time, but Gillespie algorithms would allow it to be extended into continuous time.
Our method considers compartmental models, but it could be extended to network or agent based models.
Extending the method in the above ways is non-trivial, even if we know the general way to proceed.

On the other hand, there are limitations caused by our assumptions about interventions that provide no clear path forward
Some reasonable interventions do not follow the assumptions about interventions outlined above in the general method.
Even if the intervention does follow our assumptions, the potential network may still be computationally intractable to store for complex models, large populations, or long times.
While we can address this concern for a particular intervention, the stronger assumptions we make, the less interventions follow them.
Worse, even if we ignore tractability some interventions are beyond the scope of this method.
We need to express the intervention in a way that the potential network captures, so if an intervention is too radical of a change, there is nothing we can do.

Going forward, an important extension of the work at the intersection of of computer science and epidemiology is to improve upon this method such that it remains logically consistent with fewer storage requirements. 
Interesting work remains to be done to improve our ability to make inference without continuing to significantly increase the computational power needed.
We have developed a method for utilizing computational power to address more a precise counterfactual question about interventions. 
Single-world inference allows us to more precisely understand the effects of interventions within the context of a single outbreak. 
With precise understanding, we can better determine when an intervention is effective, and when it is spurious.
Single-world inference also allows us to better compare interventions, and aids in choosing the best intervention from many possibilities. 
Single-world inference also mark a new way of leveraging computational resources to solve epidemiological problems.

\enlargethispage{20pt}

\ethics{This research did not require ethics approval as it used simulated  data.}

\dataccess{Code used for the included analyses are available upon publication.}

\aucontribute{Conception and design of study: JL\\
Development and/or verification of analytic methods: JK and JL\\
Analysis and/or interpretation of results: JK, LTK, and JL\\
Drafting the manuscript: JK and LTK\\
Revising the manuscript: JK, LTK, CJM, and JL \\
Approval of the final manuscript: JK, LTK, CJM, and JL}

\competing{We have no competing interests.}

\funding{Insert funding text here.}

\ack{Insert acknowledgment text here.}



\bibliographystyle{apalike}
\bibliography{bibliography}
\end{document}
