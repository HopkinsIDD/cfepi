#+OPTIONS: H:4
* Issues with outline
** DONE Determine appropriate distribution for $\beta SI$
   We are removing this section
   CLOSED: [2018-07-26 Thu 12:59]
** DONE Put something meaningful in something something population size
   CLOSED: [2018-07-26 Thu 12:59]
** TODO Ensure all citations are filled in
** TODO Say something about why we want to use agent based models other than 'because it works'
** TODO Take out stochastic vs deterministic part
** TODO Add motivation
** DONE Combine with outline from meeting with justin (on laptop)
   CLOSED: [2018-07-26 Thu 13:00]
   Leaving Methods out for now.  Want to commit current before making changes.
** TODO Look up names in causal inference literature for simulating what would happen if we had intervened in this epidemic vs what would happen if we intervened in a similar epidemic.
** TODO Read chapter 6.6 of Mathematics of Epidemics on Networks pg 251
** TODO Add citations for various facts in introduction
** TODO Figure out where to cite percolation
** TODO Make sure all things in the introduction are true
* Introduction
** Introduce Problem
*** Infectious Diseases are bad.  We want to control them.  Planning control is hard.
    Infectious diseases are a major global public health problem.
    Controlling their spread is challenging because planning and carrying out effective interventions is difficult \cite{}.
    Determining how and when to intervene is one of the major concerns of epidemiology.
    Sometimes we believe we know both how the disease spreads, and the mechanism by which the intervention affects that spread.
    In these cases, epidemiologists frequently employ dynamical models to assess the impact of interventions on the behaviour of the disease through simulation based approaches.
    These approaches generally take a naive approach in simulating transmission dynamics, and are therefore limited in their ability to analyze the impact of interventions by their low power.
*** We want to know the effects of interventions, and this is a causal inference problem.
    In order to accurately plan and evaluate the effect of an intervention on an epidemic, we want to compare the outcomes of if we perform the intervention with the outcomes of if we do not perform the intervention.
    However, it is not possible to both intervene and not-intervene upon a single population during a single epidemic. 
    This is known as the fundamental problem of causal inference.
    The effects of interventions at a population level are a difficult causal inference problem.
    The epidemiology of the disease confounds inference about the effects of interventions.
    On the other hand, the effects of the same interventions at an individual level are often well studied.
    Often, researchers attempt to leverage knowledge of the individual effect of the intervention, along with an understanding of the disease's epidemiology to estimate the effect of that intervention.
*** People use modeling to make the causal inference problem tractable.
    One way researchers attempt to circumvent the effects of epidemiological confounders is by modeling the epidemiology of the disease.
    They construct a model for the way the disease spreads in the population.
    Because the individual effects of the intervention are well known, the researcher can incorporate them into the model to obtain a model for the disease spread under the intervention.
    They then simulate many simulations with the intervention and without the intervention and extract values of interest.
    They then compare those values to determine the effect of the intervention.
*** Multiple World Inference    
    Although in reality we are unable to both intervene and not-intervene concurrently, this is not a desirable feature for resolving counterfactual questions.
    Most existing methods retain this feature, running separate simulations for interventions and non-interventions. 
    We refer to these types of methods as multiple world inference.
    We propose a way of running the intervention and non-intervention in the same simulation.
    We refer to our method as single world inference.
*** Shortcomings of multiple world inference
    One of the problems with multiple world inference is that outcomes of the intervention may be obfuscated by comparison across simulations. 
    Epidimiological models are stochastic, and therefore the way disease spreads varies across simulations.
    This can result in seemingly impossible outcomes occurring, such as comparing a low epidemic with intervention to a high epidemic without intervention making an effective intervention appear to cause cases.
    Likewise, one could imagine an ineffective intervention that appears to work.
    As a result of these problems, the statistical power of multiple world inference is low.
*** Outline how ywe're fixing the problems in our method and set the stage for the methods (all background and information you need to understand the methods)
    Here we outline a method that addresses these problems by performing the counterfactual in a single simulation: with and without the intervention.
    To do this we have to simulate all of the events that occur with the intervention and without the intervention, as there may be events that occur in the intervention case that do not occur in the non-intervention case, and vice versa.
    Then, the effects of the intervention can be measured within a single simulation.
    Running multiple simulations provides a measure to evaluate the impacts of a proposed intervention with higher statistical power. 
** Existing Work
*** People currently use Multiple World causal inference for this.
    Elizabeth Halloran's work on flu uses multiple world causal inference.
*** Some people already use limited versions of this method.
    While they do not make mention of this in their paper, Kenah and Miller have a single world inference method they use for determining the impact of vaccinating different individuals in a network \cite{}.
* Methods
** Motivation (Other similar methods)
*** Compartmental Models
    Compartmental models are a standard in disease modeling \cite{}.
    In compartmental models, people belong to a compartment, and the model governs the transitions between different compartments.
    There are many variations on compartmental models, but current research focuses on methods where the transition is stochastic, in order to...
    There are also individual compartmental models.
    These are used in several contexts, but are important to us since we have descriptions of the intervention at the individual level.
    We should also note that agent based models and network models exist, and our methods could apply to them, but are beyond the scope of this paper.
    
*** Percolation
    Our method is an adaptation of a method called percolation used in network theory
    In fully immunizing disease, disease only has a limited window to transmit from a particular individual to another.
    That window lasts from when the first one gets the disease to when they recover from the disease.
    From this perspective, we only need to test whether or not each pair of individuals would infect the other if they get infected.
    Using this idea, we can turn the problem of figuring out who gets infected in an epidemic into a network problem.
    We start with the network (or complete graph), and for each edge test if the disease would transmit along that edge.
    Our method will use this idea of treating the epidemic as pruning a graph, and using the connected components of that graph to determine the outcome of the epidemic.
    
** Example (Influenza)
*** SIR Model
    We use a standard short compartmental model for influenza \cite{}.
    There are compartments for susceptible, infected, and recovered.
    People move between these compartments at a rate determined by $\beta$, the force of infection, and $\gamma$ the recovery rate.
    This model is only valid for a short time scale, so we do not include births or deaths.
***** Figure: SIR Model diagram
*** Individual Models
**** Why we need stochasting models
     Our goal is to eliminate process error to improve power, but so far the models described are deterministic (and therefore have no process error).
     One could say that given a deterministic model, and a deterministic intervention, the effect of the intervention falls out cleanly.
     However, deterministic models are not widely used in the field \cite{}.
     Additionally, deterministic models cannot address a main question of interest, "How well is this intervention working?"
     
**** Viewing SIR model as a stochastic model
     Our SIR model makes implicit assumptions.
     $\beta SI$ represents interactions between susceptible and infected individuals.
     $\gamma I$ represents the probability of recovery.
     Our deterministic differential equation is actually the expectation of a stochastic process.
     Something something population size
     $\beta SI$ is ...
     $\gamma I$ is the expectation of a binomial distribution.

**** Agent Based Versions
     Instead of modeling the number of susceptibles, infected, and recovered, we want to switch and model the state of each person in our population.
     We do this, because it works.
     Instead of a vector of the number of people in each compartment, we use a vector of the state of each person.
     Each susceptible person has a $\frac{\beta}{N}$ probability of becoming infected by each infected person at each time step.
     Each infected person has a $\gamma$ probability of recovering at each time step.
     
*** Simulating and Pruning
**** Setting up the Complete Graph
     We are going to build a graph to represent the possible progression of disease through the population and time.
     We start by making a node for each person at each time.
     Each node will store the state of that person at that time.
     Since each person can transmit disease to each other person, we connect each person at each time to each other person at the next time.
     Since each person can also keep the disease over time (by not recovering), we connect each person to themselves at the next time.
     Each of these edges will 
     This graph is intractably large (for $4000000$ people, $3$ states, and $365$ time points, it would take almost $18$ pedabytes to store it).
     However, after we prune the graph, it will be small enough to use.
     
**** Conditional Probabilities
     We know the probability that a person recovers given that they are infected is $\gamma$.
     We know the probability that a person infects another person given that the first is susceptible and the second is infected is $\frac{\beta}{N}$.
     We can simulate from these distributions without knowing if the conditionals are satisfied.
     This is helpful, since we won't know a priori what the intervention affects and doesn't.
     To simulate, we draw uniformly randomly from $[0,1]$, and compare that to the probability.
     If the random draw is less than the probability, it happens.
     Otherwise, it does not happen.
     
**** Simulate all possible events
     We could account for every possible intervention by simulating every relevent conditional probability.
     Given a population size $N$, and number of time steps $T$, there are a finite number of things to simulate.
     For each time step, we need to simulate $N$ recovery probabilities, and $N^2$ infection probabilities.
     In total, we would need to simulate $N(N+1)T$ numbers.
     For a population of $4$ million, and daily time steps for a year, that would take almost $6$ million gigabytes of storage. %(4000000 * 4000001 * 365) * bytes = 5840001.46 gigabytes
     More complicated models with more compartments would take even more space.

**** Pruning simulated events
     For many interventions, not all simulations are necessary.
     By making some assumptions about the interventions, we can reduce the amount we need to store.
     We assume that the intervention can only increase the probability of infection.
     
*** Intervention
** General Framework
*** General Compartmental Model
*** Agent Based Conversion
*** Simulating and Pruning
**** Assumptions
*** Interventions
**** None
**** Vaccination
**** Treatment
**** Social Distancing
* Results
** Illustritave Simulations
*** SIR Model
*** SIS Model (maybe)
** Computational Concerns (Time/Space Complexity)
*** Current Implementation
*** Tradeoffs
** Mathematical Reduction in error (derived)
* Discussion
** Philosohpical Discussion of Question Answered
*** We often ask the question of what would happen if we had intervened in a previous epidemic.
*** We often answer the question of what would happen if we intervene in a epidemic similar to the previous one.
